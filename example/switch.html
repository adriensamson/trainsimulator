<!DOCTYPE html>
<html>
    <head>
        <title>Train simulator</title>
        <script type="text/javascript" src="../src/trainsimulator.js"></script>
        <script type="text/javascript" src="../src/drawer.js"></script>
        <script type="text/javascript" src="../src/builder.js"></script>
    </head>
    <body>
        <h1>Train simulator TEST</h1>
        <canvas id="canvas" width="800" height="200"></canvas><br />
        <script type="text/javascript">
var schema = {
    'origin': {x: 300, y: 10, angle: 0},
    'pieces': [
        {type: 'straight', length: 385, endPoint: 'sw1.2'},
        {type: 'switch', name:'switch1', point1: 'sw1.1', point2: 'sw1.2', point3: 'sw1.3'},
        {type: 'straight', length: 200, startPoint: 'sw1.1'},
        
        {type: 'curve', radius: 502.7, length: 502.7 * Math.PI / 8, clockWise: false, startPoint: 'sw1.3'},
        {type: 'curve', radius: 502.7, length: 502.7 * Math.PI / 8, clockWise: true, endPoint: 'sw2.3'},
        
        {type: 'switch', name:'switch2', point1: 'sw2.1', point2: 'sw2.2', point3: 'sw2.3'},
        {type: 'straight', length: 200, startPoint: 'sw2.1'},
        {type: 'straight', length: 200, startPoint: 'sw2.2'},
    ]
};
var builder = new TrainSimulator.TrainSimulatorBuilder();
var drawer = new TrainSimulator.CanvasDrawer(document.getElementById('canvas'));
var trainSimulator = new TrainSimulator.TrainSimulator();
builder.build(schema);
builder.registerToTrainSimulator(trainSimulator);
builder.registerToDrawer(drawer);
builder.build(schema);

var train = new TrainSimulator.Train(20);
drawer.addTrain(train);
train.putOnTrack(trainSimulator.tracks[0], 25, 1);

trainSimulator.sortElements();
drawer.redraw();
trainSimulator.sortElements();

function move() {
    train.move(parseInt(document.getElementById('speed').value));
    trainSimulator.sortElements();
    drawer.redraw();
};

var movingInterval = false;
function toggleMove() {
    if (movingInterval) {
        clearInterval(movingInterval);
        movingInterval = false;
    } else {
        movingInterval = setInterval(move, 100);
    }
};

        </script>
        <button type="button" onclick="toggleMove()">GO / STOP</button>
        <button type="button" onclick="builder.namedSwitches['switch1'].toggle();builder.namedSwitches['switch2'].toggle();">Switch All</button>
        <button type="button" onclick="document.getElementById('speed').value = document.getElementById('speed').value - 1">Speed down</button><input type="text" id="speed" value="1" size="2" /><button type="button" onclick="document.getElementById('speed').value = parseInt(document.getElementById('speed').value) + 1">Speed up</button>
    </body>
</html>

