<!DOCTYPE html>
<html>
    <head>
        <title>Train simulator</title>
        <script type="text/javascript" src="../src/trainsimulator.js"></script>
        <script type="text/javascript" src="../src/drawer.js"></script>
        <script type="text/javascript" src="../src/builder.js"></script>
        <script type="text/javascript" src="../src/roco.js"></script>
        <script type="text/javascript" src="../src/automatic.js"></script>
    </head>
    <body>
        <h1>Train simulator TEST</h1>
        <canvas id="canvas" width="800" height="300"></canvas><br />
        <script type="text/javascript">
var schema = {
    'origin': {x: 500, y: 50, angle: 0},
    'pieces': [].concat(
        RocoPieces.switchRight0('sw1', 'origin', 'sw1-2', 'sw1-3'),
        RocoPieces.straight185({startPoint: 'sw1-2', name: 'top'}),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight185({endPoint: 'sw2-2', name: 'top-end'}),
        RocoPieces.switchLeft1('sw2', 'sw2-1', 'sw2-2', 'sw2-3'),
        
        RocoPieces.curve3right({startPoint: 'sw2-1', name: 'after-sw-2'}),
        RocoPieces.curve3right(),
        RocoPieces.curve3right({name: 'before-sw-3', endPoint: 'sw3.1'}),
        
        RocoPieces.curveSwitchRight0('sw3', 'sw3.1', 'sw3.2', 'sw3.3'),
        
        RocoPieces.curve3right({startPoint: 'sw3.2', name: 'external'}),
        RocoPieces.curve3right(),
        RocoPieces.straight185(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.counterCurveRight({endPoint: 'sw4.3', name:'external-end'}),
        
        RocoPieces.curve3right({startPoint: 'sw3.3', name: 'internal'}),
        RocoPieces.curve3right(),
        RocoPieces.straight185(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight185({endPoint: 'sw4.2', name: 'internal-end'}),
        
        RocoPieces.switchRight1('sw4', 'sw4.1', 'sw4.2', 'sw4.3'),
        
        RocoPieces.straight200({startPoint: 'sw4.1', name:'after-sw-4'}),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right({endPoint: 'origin', name:'before-sw-1'}),
        
        RocoPieces.counterCurveLeft({startPoint: 'sw1-3', name: 'middle'}),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.counterCurveLeft({endPoint: 'sw2-3', name: 'middle-end'})
    )
};
var builder = new TrainSimulator.TrainSimulatorBuilder();
var drawer = new TrainSimulator.CanvasDrawer(document.getElementById('canvas'));
var trainSimulator = new TrainSimulator.TrainSimulator();
builder.build(schema);
builder.registerToTrainSimulator(trainSimulator);
builder.registerToDrawer(drawer);
drawer.scale = 0.2;
drawer.trackWidth = 16;

var block = new TrainSimulator.Block();
block.addEntry(builder.namedTracks['top-end'], 100, 150);
block.addSignal(builder.namedTracks['top-end'], 100, 1);
block.addEntry(builder.namedTracks['middle-end'], 100, 150);
block.addSignal(builder.namedTracks['middle-end'], 100, 1);
block.addEntry(builder.namedTracks['internal'], 100, 50);
block.addSignal(builder.namedTracks['internal'], 100, -1);
block.addEntry(builder.namedTracks['external'], 100, 50);
block.addSignal(builder.namedTracks['external'], 100, -1);

var block2 = new TrainSimulator.Block();
block2.addEntry(builder.namedTracks['internal-end'], 100, 150);
block2.addSignal(builder.namedTracks['internal-end'], 100, 1);
block2.addEntry(builder.namedTracks['external-end'], 100, 150);
block2.addSignal(builder.namedTracks['external-end'], 100, 1);
block2.addEntry(builder.namedTracks['top'], 100, 50);
block2.addSignal(builder.namedTracks['top'], 100, -1);
block2.addEntry(builder.namedTracks['middle'], 100, 50);
block2.addSignal(builder.namedTracks['middle'], 100, -1);

var train1 = new TrainSimulator.AutomaticTrain(500);
drawer.addTrain(train1);
train1.putOnTrack(builder.namedTracks['middle-end'], 100.5, 1);
train1.maxSpeed = 300;
train1.accel = 100;
train1.brakingAccel = 500;
train1.minForwardView = 200;
var train2 = new TrainSimulator.AutomaticTrain(500);
drawer.addTrain(train2);
train2.putOnTrack(builder.namedTracks['top-end'], 5.5, 1);
train2.maxSpeed = 300;
train2.accel = 100;
train2.brakingAccel = 500;
train2.direction = -1;
train2.minForwardView = 200;

builder.namedSwitches['sw1'].toggle();

var ticker = new TrainSimulator.Ticker();
ticker.tickDelta = 0.05;
ticker.registerMoveTickable(train1);
ticker.registerMoveTickable(train2);
ticker.registerResolveTickable(trainSimulator);
ticker.registerOutputTickable(drawer);
ticker.run();

        </script>
        
    </body>
</html>

