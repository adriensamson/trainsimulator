<!DOCTYPE html>
<html>
    <head>
        <title>Train simulator</title>
        <script type="text/javascript" src="../src/trainsimulator.js"></script>
        <script type="text/javascript" src="../src/trainsimulatorui.js"></script>
        <script type="text/javascript" src="../src/builder.js"></script>
        <script type="text/javascript" src="../src/roco.js"></script>
        <script type="text/javascript" src="../src/automatic.js"></script>
    </head>
    <body>
        <h1>Train simulator TEST</h1>
        <canvas id="canvas" width="800" height="200"></canvas><br />
        <script type="text/javascript">
var schema = {
    'origin': {x: 500, y: 50, angle: 0},
    'pieces': [].concat(
        RocoPieces.straight200({name: 'top'}),
        RocoPieces.straight185(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight185(),
        RocoPieces.straight200(),
        
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right({endPoint: 'sw1-1', name:'before-sw-1'}),
        
        RocoPieces.switchRight1('sw1', 'sw1-1', 'sw1-2', 'sw1-3'),
        RocoPieces.straight185({startPoint: 'sw1-2', name: 'bottom'}),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight185({endPoint: 'sw2-2', name: 'bottom-end'}),
        RocoPieces.switchLeft2('sw2', 'sw2-1', 'sw2-2', 'sw2-3'),
        
        RocoPieces.curve3right({startPoint: 'sw2-1', name: 'after-sw-2'}),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right(),
        RocoPieces.curve3right({endPoint: 'origin'}),
        
        RocoPieces.counterCurveLeft({startPoint: 'sw1-3', name: 'middle'}),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.straight200(),
        RocoPieces.counterCurveLeft({endPoint: 'sw2-3', name: 'middle-end'})
    )
};
var builder = new TrainSimulatorBuilder(document.getElementById('canvas'));
var tsui = builder.tsui;
builder.build(schema);
tsui.scale = 0.2;
tsui.trackWidth = 16;

var block = new Block();
block.addEntry(builder.tracks['bottom-end'], 100, 150);
block.addSignal(builder.tracks['bottom-end'], 100, 1);
block.addEntry(builder.tracks['middle-end'], 100, 150);
block.addSignal(builder.tracks['middle-end'], 100, 1);
block.addEntry(builder.tracks['bottom'], 100, 50);
block.addSignal(builder.tracks['bottom'], 100, -1);
block.addEntry(builder.tracks['middle'], 100, 50);
block.addSignal(builder.tracks['middle'], 100, -1);

var train1 = new AutomaticTrain(500);
tsui.trains.push(train1);
train1.putOnTrack(builder.tracks['middle-end'], 100.5, 1);
train1.maxSpeed = 300;
train1.accel = 100;
train1.brakingAccel = 500;
train1.minForwardView = 200;
var train2 = new AutomaticTrain(500);
tsui.trains.push(train2);
train2.putOnTrack(builder.tracks['bottom-end'], 5.5, 1);
train2.maxSpeed = 200;
train2.accel = 100;
train2.brakingAccel = 500;
train2.direction = -1;
train2.minForwardView = 200;

builder.switches['sw1'].toggle();
tsui.trainSimulator.sortElements();
tsui.redraw();
tsui.trainSimulator.sortElements();

tsui.tick = function () {
    this.trainSimulator.sortElements();
    this.redraw();
};

var ticker = new Ticker();
ticker.tickDelta = 0.05;
ticker.registerTickable(tsui);
ticker.registerTickable(train1);
ticker.registerTickable(train2);
ticker.run();

        </script>
        <!--button type="button" onclick="builder.switches['sw1'].toggle();builder.switches['sw2'].toggle();">Switch All</button-->
        <br />
        <!--button type="button" onclick="document.getElementById('speed1').value = parseInt(document.getElementById('speed1').value) - 1">Speed down</button>
        <input type="text" id="speed1" value="0" size="2" />
        <button type="button" onclick="document.getElementById('speed1').value = parseInt(document.getElementById('speed1').value) + 1">Speed up</button-->
        <br />
        <!--button type="button" onclick="document.getElementById('speed2').value = parseInt(document.getElementById('speed2').value) - 1">Speed down</button>
        <input type="text" id="speed2" value="0" size="2" />
        <button type="button" onclick="document.getElementById('speed2').value = parseInt(document.getElementById('speed2').value) + 1">Speed up</button-->
        
    </body>
</html>

